version: 2

models:
  - name: stg_rxnorm__ndc
    description: "RxNorm NDCs"
    columns:
      - name: ndc
        description: "The NDC in NDC11 format."
        tests:
          # NOTE: there are 8 NDCs not in the correct format, so our
          # custom ndc_to_11 function returns NULL, which breaks
          # both the not_null and unique tests
          - unique
          - not_null
      - name: clinical_product_rxcui
      - name: brand_product_rxcui
      - name: active
      - name: prescribable

  - name: stg_rxnorm__clinical_product
    description: "RxNorm clinical products (SCD, GPCK)."
    columns:
      - name: rxcui
        tests:
          - unique
          - not_null
      - name: name
      - name: tty
      - name: active
      - name: prescribable

  - name: stg_rxnorm__clinical_product_component_link
    description: "Links clinical products (SCD/GPCK) with clinical product components (SCD only)."
    columns:
      # primary key would be clinical_product_rxcui + clinical_product_component_rxcui
      - name: clinical_product_rxcui
        tests:
          - not_null
      - name: clinical_product_component_rxcui
        tests:
          - not_null

  - name: stg_rxnorm__clinical_product_component
    description: "RxNorm clinical product components (SCD)."
    columns:
    - name: rxcui
      tests:
        - unique
        - not_null
    - name: name
    - name: tty
    - name: active
    - name: prescribable
    - name: ingredient_rxcui
    - name: dose_form_rxcui

  - name: stg_rxnorm__dose_form
    description: "RxNorm dose forms (DF)."
    columns:
    - name: rxcui
      tests:
        - unique
        - not_null
    - name: name
    - name: tty
    - name: active
    - name: prescribable

  - name: stg_rxnorm__dose_form_group_link
    description: "Links dose forms (DF) to dose form groups (DFG)."
    columns:
      # primary key would be dose_form_rxcui + dose_form_group_rxcui
      - name: dose_form_rxcui
        tests:
          - not_null
      - name: dose_form_group_rxcui
        tests:
          - not_null

  - name: stg_rxnorm__dose_form_group
    description: "RxNorm dose form groups (DFG)."
    columns:
    - name: rxcui
      tests:
        - unique
        - not_null
    - name: name
    - name: tty
    - name: active
    - name: prescribable

  - name: stg_rxnorm__ingredient
    description: "RxNorm ingredients (IN/MIN)."
    columns:
    - name: rxcui
      tests:
        - unique
        - not_null
    - name: name
    - name: tty
    - name: active
    - name: prescribable

  - name: stg_rxnorm__ingredient_component_link
    description: "Links ingredients (IN/MIN) to ingredient components (IN)."
    columns:
    # primary key would be ingredient_rxcui + ingredient_component_rxcui
    - name: ingredient_rxcui
      tests:
        - not_null
    - name: ingredient_component_rxcui
      tests:
        - not_null
  
  - name: stg_rxnorm__mthspl_product
    description: "DailyMed SPL products (DP) at NDC9 level."
    columns:
    - name: rxcui
      tests:
        - not_null
    - name: name
    - name: tty
    - name: rxaui
    - name: ndc
    - name: active
    - name: prescribable

  - name: stg_rxnorm__mthspl_substance
    description: "DailyMed SPL substances (SU)."
    columns:
    - name: rxcui
      tests:
        - not_null
    - name: name
    - name: tty
    - name: rxaui
    - name: unii
    - name: active
    - name: prescribable

  - name: stg_rxnorm__brand_product
    description: "RxNorm brand name products (SBD/BPCK)."
    columns:
    - name: rxcui
      tests:
        - unique
        - not_null
    - name: name
    - name: tty
    - name: clinical_product_rxcui
    - name: active
    - name: prescribable

  - name: stg_rxnorm__brand_product_component_link
    description: "Links brand products (SBD/BPCK) with brand product components (mostly SBD, but BPCKs can also contain SCD)."
    columns: 
      # primary key would be brand_product_rxcui + brand_product_component_rxcui
      - name: brand_product_rxcui
        tests:
          - not_null
      - name: brand_product_component_rxcui
        tests:
          - not_null

  - name: stg_rxnorm__brand_product_component
    description: "RxNorm brand product components (mostly SBD, but BPCKs can also contain SCD)."
    columns:
    - name: rxcui
      tests:
        - unique
        - not_null
    - name: name
    - name: tty
    - name: clinical_product_component_rxcui
      tests:
        - not_null
    - name: brand_rxcui
      description: "NOTE: brand_product_component SCDs will have NULL for brand_rxcui."
    - name: active
    - name: prescribable

  - name: stg_rxnorm__brand
    description: "RxNorm brand names (BN)."
    columns:
      - name: rxcui
        tests:
          - unique
          - not_null
      - name: name
      - name: tty
      - name: active
      - name: prescribable
      - name: ingredient_rxcui

